name: âš™ï¸ CI - PR Label Test

on:
  pull_request:
    types:
      - opened
      - reopened
      # - synchronize
    branches: [main, develop]

jobs:
  check_pr_labels:
    runs-on: macos-15
    steps:
      - name: ğŸ” Check PR labels
        run: |
          echo "Checking PR labels..."

          # GitHubì—ì„œ ë‚´ë ¤ì˜¨ PR ì´ë²¤íŠ¸ë¥¼ í™•ì¸ìš©ìœ¼ë¡œ ì°ê¸°
          echo "github.event_name: ${{ github.event_name }}"
          echo "github.event.action: ${{ github.event.action }}"
          echo "github.event.pull_request.number: ${{ github.event.pull_request.number }}"
          echo "github.event.pull_request.title: ${{ github.event.pull_request.title }}"
          # labelsëŠ” ë°°ì—´ì´ë¼ toJsonìœ¼ë¡œ ì°ì–´ì¤˜ì•¼ í•¨
          echo "github.event.pull_request.labels (json): ${{ toJson(github.event.pull_request.labels) }}"

          # PR ì´ë²¤íŠ¸ì¸ì§€ í•œ ë²ˆ ë” ë°©ì–´
          if [ "${{ github.event_name }}" != "pull_request" ]; then
            echo "This is not a pull_request event. Skipping."
            exit 0
          fi

          # GitHubê°€ ë‚´ë ¤ì£¼ëŠ” ì´ë²¤íŠ¸ JSON íŒŒì¼ì—ì„œ ë¼ë²¨ë§Œ ë½‘ê¸°
          labels=$(jq -r '.pull_request.labels[].name // empty' "$GITHUB_EVENT_PATH")

          echo "Detected labels: $labels"

          if echo "$labels" | grep -q "âš™ï¸ ENV"; then
            echo "âœ… 'âš™ï¸ ENV' label detected."
          else
            echo "â 'âš™ï¸ ENV' label not found."
          fi

          # í…ŒìŠ¤íŠ¸ìš©ì´ë‹ˆê¹Œ í•­ìƒ ì„±ê³µìœ¼ë¡œ ëëƒ„
          exit 0